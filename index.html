<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>チームビルディング・カードゲーム</title>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", sans-serif; line-height: 1.5; }
    .muted { color:#666; font-size:12px; }

    .grid{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      padding:0;
      margin:8px 0 0 0;
      list-style:none;
    }

    .card{
      width:180px;
      min-height:110px;
      border:2px solid #333;
      border-radius:12px;
      padding:10px;
      box-sizing:border-box;
      user-select:none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:8px;
    }
    .card.clickable { cursor:pointer; }
    .selected{
      border-color:#0b57d0;
      box-shadow: 0 0 0 3px rgba(11,87,208,0.18), 0 3px 10px rgba(0,0,0,0.14);
      font-weight:700;
    }

    /* 色分け */
    .type-environment { background:#dff7ff; border-color:#0aa2c0; } /* 環境 */
    .type-budget      { background:#e7ffe7; border-color:#1b7f2a; } /* 予算 */
    .type-riskmgmt    { background:#ffe3e3; border-color:#c62828; } /* リスクマネジメント */
    .type-people      { background:#e8f0ff; border-color:#2a5bd7; } /* 人材 */
    .type-quality     { background:#fff1cc; border-color:#b7791f; } /* 品質 */
    .type-time        { background:#f1e8ff; border-color:#6a3fb1; } /* 時間 */

    .card-title { font-size:18px; font-weight:800; text-align:center; }
    .card-sub { font-size:12px; color:#444; text-align:center; }

    .btnrow{
      display:flex;
      gap:8px;
      justify-content:center;
      margin-top:6px;
    }
    button { cursor:pointer; }

    #adminPanel{
      border:1px solid #ccc;
      padding:12px;
      margin:12px 0;
      border-radius:10px;
      background:#fafafa;
    }
    #inviteLinks li{ margin:6px 0; word-break: break-all; }

    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    input[type="text"]{ padding:6px 8px; border:1px solid #ccc; border-radius:8px; }

    /* メッセージUI */
    #msgBox{
      border:1px solid #ddd;
      border-radius:12px;
      padding:12px;
      background:#fafafa;
      margin-top:12px;
    }
    #msgList{
      border:1px solid #ddd;
      border-radius:12px;
      background:#fff;
      padding:10px;
      height:260px;
      overflow:auto;
      margin-top:8px;
    }
    .msgItem{
      padding:8px 10px;
      border-radius:10px;
      margin:6px 0;
      max-width: 760px;
      word-break: break-word;
    }
    .msgMine{ background:#e8f0ff; margin-left:auto; }
    .msgTheirs{ background:#f3f3f3; margin-right:auto; }
    .msgMeta{ font-size:11px; color:#666; margin-top:4px; }
    textarea{
      width:min(760px, 100%);
      height:70px;
      padding:8px 10px;
      border:1px solid #ccc;
      border-radius:10px;
      resize:vertical;
    }
  </style>
</head>

<body>
  <h1>チームビルディング・カードゲーム</h1>

  <p id="meLabel" style="font-weight:bold;"></p>
  <p class="muted">※ 手札のカードをクリックすると「交換に出すカード」として選択されます</p>

  <!-- 運営パネル -->
  <div id="adminPanel" style="display:none;">
    <h2>運営パネル</h2>

    <div class="row">
      <span>部屋ID：</span>
      <code id="roomLabel"></code>
      <button onclick="newRoom()">新しい部屋を作る</button>
    </div>

    <div class="row" style="margin-top:8px;">
      <span>部屋IDを指定して切替：</span>
      <input id="roomInput" type="text" placeholder="例）tokyoA" />
      <button onclick="goRoom()">この部屋へ移動</button>
    </div>

    <div style="margin-top:12px;">
      <button onclick="dealCards()">カードを配布（この部屋だけ）</button>
    </div>

    <h3>参加者URL（この部屋）</h3>
    <ul id="inviteLinks"></ul>
  </div>

  <h2>指示書</h2>
<div id="instructionBox" class="muted">カード配布後に表示されます。</div>  

  <hr />

  <h2 id="handTitle"></h2>
  <p id="selectedText">選択中：なし</p>
  <ul id="hand" class="grid"></ul>

<hr />

  <h3>交換</h3>
  <label>交換相手：</label>
  <select id="partnerSelect"></select>
  <button onclick="requestTrade()">交換リクエスト（選択カードを出す）</button>

  <h3>送信中リクエスト</h3>
  <ul id="outgoing" class="grid"></ul>

  <h3>受信中リクエスト</h3>
  <p class="muted">※ 承認する前に、あなたも「渡す1枚」を手札から選んでください</p>
  <ul id="incoming" class="grid"></ul>

  <hr />

  <!-- ✅ メッセージ -->
  <h2>メッセージ（直属のみ）</h2>
  <p class="muted">この部屋の総メッセージ数：<b id="msgCount">0</b></p>
  <div id="msgBox">
    <div class="row">
      <label>送信先：</label>
      <select id="msgTo"></select>
      <span class="muted">※ 直属の上司・部下のみ選べます</span>
    </div>

    <div style="margin-top:8px;">
      <textarea id="msgText" placeholder="メッセージを入力"></textarea>
    </div>

    <div class="row" style="margin-top:8px;">
      <button onclick="sendMessage()">送信</button>
      <span class="muted" id="msgHint"></span>
    </div>

    <div id="msgList"></div>
  </div>

  <hr />
  <h3>ログ</h3>
  <pre id="log" style="white-space:pre-wrap;"></pre>

  <!-- Firebase SDK（順番厳守） -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script src="script.js"></script>
</body>
</html>




